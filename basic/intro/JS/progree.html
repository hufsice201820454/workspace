<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Bootstrap demo</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr"
      crossorigin="anonymous"
    />
  </head>
  <body>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q"
      crossorigin="anonymous"
    ></script>

    <div
      class="progress"
      role="progressbar"
      aria-label="Basic example"
      aria-valuenow="0"
      aria-valuemin="0"
      aria-valuemax="100"
      style="height: 30px;"
    >
      <div class="progress-bar" style="width: 0%"></div>
    </div>

    <button type="button" class="btn btn-primary mt-3" id="startBtn">
      Primary
    </button>

    <script>
      const progressBar = document.querySelector(".progress-bar");
      const button = document.getElementById("startBtn");

      button.addEventListener("click", () => {
        progressBar.style.width = "0%";
        progressBar.setAttribute("aria-valuenow", 0);

        // 종료 시간 3초 ~ 5초 사이 랜덤 (ms)
        const endTime = (Math.floor(Math.random() * 3) + 3) * 1000;
        let elapsed = 0;
        let width = 0;

        const interval = setInterval(() => {
          elapsed += 1000;
          width += 10; // 1초마다 10%

          if (elapsed >= endTime) {
            // 종료 시간 도달 시 100%로 설정하고 중지
            progressBar.style.width = "100%";
            progressBar.setAttribute("aria-valuenow", 100);
            clearInterval(interval);
          } else {
            progressBar.style.width = width + "%";
            progressBar.setAttribute("aria-valuenow", width);
          }
        }, 1000);
      });
      //이런식으로 코드를 짜면, 클릭할때마다 Interval ID가 지속적으로 생성되어, 메모리 안에 지속적으로 상주하게 된다
      //따라서 global 변수 intervalID = null;로 초기 생성하고, 
      // if (intervalId != null){
      //    clearInterval(intervalId);
      //    interbalID = null;
      //}
      //이러한 로직을 추가하여 버튼 추가 클릭 시, 하던 프로세스를 버린후 재 생성하게 하면, 메모리의 누수를 줄일 수 있음
        
    </script>
  </body>
</html>
